<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= tour.title %> - Soul Trip Tours and Travels</title>
    <meta
      name="description"
      content="<%= tour.description %> Duration: <%= tour.duration %>. Starting from $<%= tour.price %> USD."
    />
    <link href="/css/style.css" rel="stylesheet" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>
  <body class="bg-gray-50">
    <%- include('partials/header') %>

    <!-- Hero Section -->
    <section
      class="relative h-96 bg-cover bg-center"
      style="background-image: linear-gradient(45deg, rgba(0,0,0,0.6), rgba(0,0,0,0.3)), url('<%= tour.image.startsWith("http") ? tour.image : (tour.image.startsWith("/") ? tour.image : "/images/" + tour.image) %>')"
    >
      <div
        class="absolute inset-0 bg-gradient-to-r from-black/70 via-black/50 to-black/30"
      ></div>
      <div class="relative container-custom h-full flex items-center">
        <div class="text-white max-w-4xl">
          <div class="mb-4">
            <span
              class="bg-primary-600 text-white px-4 py-2 rounded-full text-sm font-semibold"
            >
              <%= tour.category %>
            </span>
          </div>
          <h1 class="text-4xl lg:text-6xl font-bold mb-4 text-shadow-lg">
            <%= tour.title %>
          </h1>
          <p class="text-xl text-gray-200 mb-6 text-shadow">
            <%= tour.description %>
          </p>
          <div class="flex flex-wrap items-center gap-6 text-lg">
            <div class="flex items-center">
              <i class="fas fa-clock mr-2"></i>
              <span><%= tour.duration %></span>
            </div>
            <div class="flex items-center">
              <i class="fas fa-map-marker-alt mr-2"></i>
              <span><%= tour.destination %></span>
            </div>
            <div class="flex items-center">
              <i class="fas fa-dollar-sign mr-2"></i>
              <span>From $<%= tour.price %> USD</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <div class="container-custom py-12">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-12">
        <!-- Main Content -->
        <div class="lg:col-span-2 space-y-8">
          <!-- Tour Overview -->
          <div class="bg-white rounded-xl p-8 shadow-lg">
            <h2 class="text-3xl font-bold text-gray-900 mb-6">Tour Overview</h2>
            <p class="text-gray-600 text-lg leading-relaxed mb-6">
              <%= tour.description %> This carefully crafted journey offers the
              perfect blend of adventure, culture, and unforgettable experiences
              that will create memories to last a lifetime.
            </p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div class="space-y-4">
                <h3 class="text-xl font-semibold text-gray-900">Quick Facts</h3>
                <div class="space-y-2">
                  <div class="flex items-center">
                    <i class="fas fa-clock text-primary-600 mr-3"></i>
                    <span><strong>Duration:</strong> <%= tour.duration %></span>
                  </div>
                  <div class="flex items-center">
                    <i class="fas fa-map-marker-alt text-primary-600 mr-3"></i>
                    <span
                      ><strong>Destination:</strong> <%= tour.destination
                      %></span
                    >
                  </div>
                  <div class="flex items-center">
                    <i class="fas fa-route text-primary-600 mr-3"></i>
                    <span><strong>Route:</strong> <%= tour.route %></span>
                  </div>
                  <div class="flex items-center">
                    <i class="fas fa-tag text-primary-600 mr-3"></i>
                    <span><strong>Category:</strong> <%= tour.category %></span>
                  </div>
                </div>
              </div>

              <div class="space-y-4">
                <h3 class="text-xl font-semibold text-gray-900">
                  What's Included
                </h3>
                <div class="space-y-2 text-gray-600">
                  <div class="flex items-center">
                    <i class="fas fa-check text-green-500 mr-3"></i>
                    <span>Expert local guides</span>
                  </div>
                  <div class="flex items-center">
                    <i class="fas fa-check text-green-500 mr-3"></i>
                    <span>Accommodation</span>
                  </div>
                  <div class="flex items-center">
                    <i class="fas fa-check text-green-500 mr-3"></i>
                    <span>Transportation</span>
                  </div>
                  <div class="flex items-center">
                    <i class="fas fa-check text-green-500 mr-3"></i>
                    <span>Some meals</span>
                  </div>
                  <div class="flex items-center">
                    <i class="fas fa-check text-green-500 mr-3"></i>
                    <span>Activity fees</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Highlights -->
          <div class="bg-white rounded-xl p-8 shadow-lg">
            <h2 class="text-3xl font-bold text-gray-900 mb-6">
              Tour Highlights
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <% tour.highlights.forEach(highlight => { %>
              <div class="flex items-center p-4 bg-gray-50 rounded-lg">
                <i class="fas fa-star text-accent-500 mr-3"></i>
                <span class="font-medium text-gray-800"><%= highlight %></span>
              </div>
              <% }) %>
            </div>
          </div>

          <!-- Itinerary Sample -->
          <div class="bg-white rounded-xl p-8 shadow-lg">
            <h2 class="text-3xl font-bold text-gray-900 mb-6">
              Sample Itinerary
            </h2>
            <div class="space-y-6">
              <div class="border-l-4 border-primary-600 pl-6">
                <div class="flex items-center mb-2">
                  <span
                    class="bg-primary-600 text-white w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold mr-3"
                    >1</span
                  >
                  <h3 class="text-xl font-semibold text-gray-900">
                    Arrival Day
                  </h3>
                </div>
                <p class="text-gray-600">
                  Welcome to your adventure! Meet your group and guide, settle
                  into your accommodation, and enjoy a welcome dinner.
                </p>
              </div>

              <div class="border-l-4 border-primary-600 pl-6">
                <div class="flex items-center mb-2">
                  <span
                    class="bg-primary-600 text-white w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold mr-3"
                    >2</span
                  >
                  <h3 class="text-xl font-semibold text-gray-900">
                    First Adventure
                  </h3>
                </div>
                <p class="text-gray-600">
                  Begin exploring the highlights of your destination with guided
                  activities and cultural immersion.
                </p>
              </div>

              <div class="border-l-4 border-primary-600 pl-6">
                <div class="flex items-center mb-2">
                  <span
                    class="bg-primary-600 text-white w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold mr-3"
                    >3</span
                  >
                  <h3 class="text-xl font-semibold text-gray-900">
                    Main Attractions
                  </h3>
                </div>
                <p class="text-gray-600">
                  Visit the most famous landmarks and hidden gems, with plenty
                  of free time for personal exploration.
                </p>
              </div>

              <div class="text-center">
                <p class="text-gray-500 italic">
                  ... and many more exciting days ahead!
                </p>
                <button onclick="openBookingModal()" class="mt-4 btn-primary">
                  Get Full Itinerary & Book
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Booking Sidebar -->
        <div class="lg:col-span-1">
          <div class="bg-white rounded-xl p-8 shadow-lg sticky top-24">
            <div class="text-center mb-6">
              <div class="text-4xl font-bold text-primary-600 mb-2">
                $<%= tour.price %>
              </div>
              <p class="text-gray-600">per person</p>
            </div>

            <div class="space-y-4 mb-6">
              <div class="flex justify-between">
                <span class="text-gray-600">Duration:</span>
                <span class="font-semibold"><%= tour.duration %></span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">Group Size:</span>
                <span class="font-semibold">Max 16 people</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">Difficulty:</span>
                <span class="font-semibold">Moderate</span>
              </div>
            </div>

            <button
              onclick="openBookingModal()"
              class="w-full btn-primary text-lg py-4 mb-4"
            >
              Book This Tour
            </button>

            <div class="text-center text-sm text-gray-600 mb-4">
              <i class="fas fa-shield-alt text-green-500 mr-1"></i>
              Free cancellation up to 30 days
            </div>

            <div class="border-t pt-4">
              <h3 class="font-semibold text-gray-900 mb-3">Need Help?</h3>
              <div class="space-y-2 text-sm">
                <div class="flex items-center">
                  <i class="fas fa-phone text-primary-600 mr-2"></i>
                  <span><%= settings.contact_phone || '+880 1616-578097' %></span>
                </div>
                <div class="flex items-center">
                  <i class="fas fa-envelope text-primary-600 mr-2"></i>
                  <span><%= settings.contact_email || 'soultripst@gmail.com' %></span>
                </div>
                <div class="flex items-center">
                  <i class="fas fa-clock text-primary-600 mr-2"></i>
                  <span><%= settings.business_hours || 'Saturday-Thursday: 9:00 AM - 6:00 PM, Friday: Closed' %></span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Booking Modal -->
    <div
      id="bookingModal"
      class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4"
    >
      <div
        class="bg-white rounded-xl max-w-md w-full p-8 max-h-screen overflow-y-auto"
      >
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-bold text-gray-900">Book Your Adventure</h2>
          <button
            onclick="closeBookingModal()"
            class="text-gray-500 hover:text-gray-700"
          >
            <i class="fas fa-times text-2xl"></i>
          </button>
        </div>

        <div class="mb-4 p-4 bg-primary-50 rounded-lg">
          <h3 class="font-semibold text-primary-900"><%= tour.title %></h3>
          <p class="text-primary-700 text-sm">
            $<%= tour.price %> USD per person
          </p>
        </div>

        <form id="bookingForm" class="space-y-4">
          <input type="hidden" name="tourId" value="<%= tour.id %>" />

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >Full Name *</label
            >
            <input
              type="text"
              name="name"
              required
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"
            />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >Email *</label
            >
            <input
              type="email"
              name="email"
              required
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"
            />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >Phone *</label
            >
            <input
              type="tel"
              name="phone"
              required
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"
            />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >Preferred Start Date</label
            >
            <input
              type="date"
              name="date"
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"
            />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >Number of Participants</label
            >
            <select
              name="participants"
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"
            >
              <option value="1">1 person</option>
              <option value="2">2 people</option>
              <option value="3">3 people</option>
              <option value="4">4 people</option>
              <option value="5+">5+ people</option>
            </select>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >Special Requirements</label
            >
            <textarea
              name="specialRequests"
              rows="3"
              placeholder="Any special requests, dietary requirements, or questions..."
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"
            ></textarea>
          </div>

          <button type="submit" class="w-full btn-primary text-lg py-4">
            Submit Booking Request
          </button>

          <p class="text-xs text-gray-600 text-center">
            This is a booking inquiry. We'll contact you to confirm availability
            and finalize your reservation.
          </p>
        </form>
      </div>
    </div>

    <%- include('partials/footer') %>

    <script>
      // Mobile menu toggle
      document
        .getElementById("mobile-menu-btn")
        .addEventListener("click", function () {
          const mobileMenu = document.getElementById("mobile-menu");
          mobileMenu.classList.toggle("hidden");
        });

      // Booking modal functions
      function openBookingModal() {
        document.getElementById("bookingModal").classList.remove("hidden");
        document.body.style.overflow = "hidden";
      }

      function closeBookingModal() {
        document.getElementById("bookingModal").classList.add("hidden");
        document.body.style.overflow = "auto";
      }

      // Close modal when clicking outside
      document
        .getElementById("bookingModal")
        .addEventListener("click", function (e) {
          if (e.target === this) {
            closeBookingModal();
          }
        });

      // Booking form submission
      document
        .getElementById("bookingForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const formData = new FormData(this);
          const data = Object.fromEntries(formData);

          try {
            const response = await fetch("/book", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(data),
            });

            const result = await response.json();

            if (result.success) {
              alert(result.message);
              closeBookingModal();
              this.reset();
            } else {
              alert(result.message);
            }
          } catch (error) {
            alert(
              "There was an error submitting your booking. Please try again."
            );
          }
        });
    </script>
  </body>
</html>
